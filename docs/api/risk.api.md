```markdown
# Risk Aggregator — API

```ts
/**
 * @spec specs/risk.spec.md
 * @example examples/analysis-engine.examples.md
 */
class RiskAggregator {
  /**
   * Aggregates four normalized metrics into a final risk score and classification.
   *
   * Applies Formula 12: R = w1×M1 + w2×M2 + w3×M3 + w4×M4
   * Applies Formula 14: Classifies R into CRITICAL | HIGH | MEDIUM | LOW
   *
   * @param metrics - Individual metric results from all calculators.
   * @returns Complete risk assessment with score, level, confidence, and reasoning.
   */
  async aggregate(metrics: MetricInputs): Promise<RiskAssessment> {
    // Cursor: Implement per risk.spec.md
  }

  /**
   * Loads configurable weight coefficients from Configuration Store.
   */
  private async loadWeights(): Promise<WeightCoefficients> {
    // Cursor: Implement
  }

  /**
   * Validates that all weights sum to 1.0 and are within [0, 1].
   */
  private validateWeights(weights: WeightCoefficients): void {
    // Cursor: Implement
  }

  /**
   * Computes weighted linear combination (Formula 12).
   */
  private calculateRiskScore(
    metrics: NormalizedMetrics,
    weights: WeightCoefficients
  ): number {
    // Cursor: Implement
  }

  /**
   * Classifies risk score into discrete threat level (Formula 14).
   */
  private classifyRiskLevel(score: number): RiskLevel {
    // Cursor: Implement
  }

  /**
   * Calculates overall confidence using weighted metric confidences.
   */
  private calculateConfidence(
    metrics: MetricInputs,
    weights: WeightCoefficients
  ): number {
    // Cursor: Implement
  }

  /**
   * Detects conflicts between metrics (e.g., high M1 but low M3).
   */
  private detectMetricConflicts(metrics: NormalizedMetrics): ConflictAnalysis {
    // Cursor: Implement
  }

  /**
   * Builds human-readable reasoning and recommendations.
   */
  private buildReasoning(
    score: number,
    level: RiskLevel,
    contributions: MetricContribution[],
    conflicts: ConflictAnalysis
  ): Reasoning {
    // Cursor: Implement
  }

  /**
   * Applies user sensitivity adjustments (strict/balanced/relaxed).
   */
  private applySensitivityAdjustment(
    score: number,
    sensitivity: 'strict' | 'balanced' | 'relaxed'
  ): number {
    // Cursor: Implement
  }
}
```

---

## Types

```ts
interface MetricInputs {
  requestRate: RateMetricResult;
  entropy: EntropyMetricResult;
  reputation: ReputationMetricResult;
  behavior: BehaviorMetricResult;
}

interface NormalizedMetrics {
  M1: number;
  M2: number;
  M3: number;
  M4: number;
}

interface WeightCoefficients {
  requestRate: number;     // w1 = 0.15
  entropy: number;         // w2 = 0.25
  reputation: number;      // w3 = 0.40
  behavior: number;        // w4 = 0.20
}

interface MetricContribution {
  name: 'M1' | 'M2' | 'M3' | 'M4';
  value: number;
  weight: number;
  contribution: number;    // value × weight
  percentage: string;      // e.g., "24.5%"
}

interface ConflictAnalysis {
  hasConflict: boolean;
  conflictingPairs: Array<{
    metricA: string;
    metricB: string;
    difference: number;
  }>;
}

interface Reasoning {
  primary: string[];       // e.g., ["High reputation score from PhishTank"]
  factors: string[];
  recommendations: string[];
  metricContributions: Record<'M1' | 'M2' | 'M3' | 'M4', MetricContribution>;
}

type RiskLevel = 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW';

interface RiskAssessment {
  score: number;                    // R ∈ [0, 1]
  level: RiskLevel;
  confidence: number;               // ∈ [0, 1]
  metrics: NormalizedMetrics;
  weights: WeightCoefficients;
  reasoning: Reasoning;
  timestamp: number;
}
```

---

## Configuration (via DI or config store)

```ts
interface RiskAggregatorConfig {
  defaultWeights: WeightCoefficients;
  classificationThresholds: {
    critical: number;   // 0.8
    high: number;       // 0.6
    medium: number;     // 0.4
  };
  confidenceAdjustments: {
    allMetricsAvailable: number;     // +0.10
    reputationMissing: number;       // -0.40
    highConflict: number;            // -0.30
    multipleSourcesAgree: number;    // +0.20
  };
  sensitivityPresets: {
    strict: { scoreMultiplier: number };
    balanced: { scoreMultiplier: number };
    relaxed: { scoreMultiplier: number };
  };
}
```

---

*This file contains **only public API and types**.  
Full implementation is generated by Cursor using `risk.spec.md` and this contract.*
```